<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ¡ˆä»¶æ‡‰å‚™æ–‡ä»¶æª¢æ ¸è¡¨</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2c3e50">
    <link rel="apple-touch-icon" href="icon.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        :root { --primary: #2c3e50; --bg: #f0f2f5; --email-blue: #0056b3; }
        body { 
            font-family: "Microsoft JhengHei", sans-serif; 
            background: var(--bg); margin: 0; padding: 15px; 
            display: flex; flex-direction: column; align-items: center; 
            -webkit-user-select: none; user-select: none; 
            padding-bottom: 80px; /* å¢åŠ åº•éƒ¨ç©ºé–“çµ¦æŒ‰éˆ• */
        }
        
        .paper { 
            background: white; width: 100%; max-width: 600px; 
            padding: 30px; border-radius: 2px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.1); 
            margin-bottom: 20px; 
            border-top: 6px solid var(--primary);
            box-sizing: border-box;
        }

        h2 { text-align: center; color: var(--primary); margin-top: 0; border-bottom: 2px double var(--primary); padding-bottom: 15px; margin-bottom: 25px; }

        /* --- ç¬¬ä¸€éƒ¨åˆ†ï¼šæ¡ˆä»¶è³‡è¨Š (ä½¿ç”¨ Grid é”æˆå®Œç¾å°é½Š) --- */
        .info-grid {
            display: grid;
            /* å®šç¾©ä¸‰æ¬„ï¼šæ¨™ç±¤(å›ºå®šå¯¬) å†’è™Ÿ(è‡ªå‹•) è¼¸å…¥æ¡†(å¡«æ»¿) */
            grid-template-columns: 80px auto 1fr; 
            gap: 15px 10px; /* è¡Œè· åˆ—è· */
            align-items: center;
            margin-bottom: 25px;
        }

        .form-label { 
            font-weight: bold; color: #333; 
            text-align: justify; 
            text-align-last: justify; /* è®“æ–‡å­—å¼·è¿«å·¦å³å°é½Šåˆ†æ•£ */
        }

        .form-colon { font-weight: bold; }

        /* ä¸‹æ‹‰é¸å–®èˆ‡è¼¸å…¥æ¡†æ¨£å¼ */
        select, input[type="text"] {
            width: 100%; border: none; border-bottom: 1px solid #000; 
            font-size: 1rem; padding: 5px 0; background: transparent; 
            border-radius: 0; outline: none; font-family: inherit;
            -webkit-user-select: text; user-select: text;
        }
        select { 
            -webkit-appearance: none; 
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 4 5"><path fill="%23333" d="M2 0L0 2h4zm0 5L0 3h4z"/></svg>') no-repeat right 0px center / 10px 10px; 
            cursor: pointer;
        }
        input[type="text"]:focus { border-bottom: 2px solid var(--primary); }

        /* --- ç¬¬äºŒéƒ¨åˆ†ï¼šæ¸…å–® --- */
        .checklist-container { border: 1px solid #ddd; padding: 20px; border-radius: 8px; background: #fafafa; }
        
        .instruction { 
            font-size: 0.95rem; color: #555; font-weight: bold; 
            margin-bottom: 20px; line-height: 1.6; 
            border-bottom: 1px dashed #ccc; padding-bottom: 15px;
        }
        
        .email-link {
            display: block; /* æ›è¡Œ */
            color: var(--email-blue);
            text-decoration: underline;
            margin-left: 1.5em; /* ç¸®æ’å°é½Šä¸Šä¸€è¡Œçš„æ–‡å­— */
            margin-top: 5px;
        }
        
        .check-item { display: flex; align-items: flex-start; margin-bottom: 12px; cursor: pointer; }
        .check-item input[type="checkbox"] { 
            width: 20px; height: 20px; margin-right: 12px; margin-top: 2px; 
            accent-color: var(--primary); flex-shrink: 0; cursor: pointer;
        }
        .check-item span { font-size: 1rem; color: #333; line-height: 1.5; padding-top: 1px; }

        /* è¡Œå…§è¼¸å…¥æ¡† (çµ¦ã€Œå…¶ä»–ã€ä½¿ç”¨) */
        .inline-input {
            border: none; border-bottom: 1px solid #666;
            background: transparent; margin-left: 10px;
            flex-grow: 1; font-size: 1rem; color: #333;
            outline: none; width: 50px; /* æœ€å°å¯¬åº¦ */
        }
        .inline-input:focus { border-bottom: 2px solid var(--primary); }

        /* --- æŒ‰éˆ•ç¾¤çµ„ --- */
        .btn-group { 
            width: 100%; max-width: 600px; display: flex; gap: 15px; 
            position: fixed; bottom: 20px; padding: 0 15px; box-sizing: border-box; z-index: 100;
        }
        .btn { 
            flex: 1; border: none; padding: 15px; border-radius: 30px; 
            font-size: 1rem; font-weight: bold; cursor: pointer; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.2); transition: 0.2s; 
            display: flex; align-items: center; justify-content: center; gap: 8px;
        }
        .btn:active { transform: scale(0.98); }
        .btn-img { background: var(--primary); color: white; }
        .btn-share { background: #27ae60; color: white; }

    </style>
</head>
<body>

    <div class="paper" id="capture-area">
        <h2>æ¡ˆä»¶æ‡‰å‚™æ–‡ä»¶æª¢æ ¸è¡¨</h2>
        
        <div class="info-grid">
            <div class="form-label">æ¡ˆç”±</div>
            <div class="form-colon">ï¼š</div>
            <div><input type="text" id="case-cause"></div>

	    <div class="form-label">æ¡ˆä»¶å¯©ç´š</div>
            <div class="form-colon">ï¼š</div>
            <div>
                <select id="case-level">
                    <option value="" disabled selected>è«‹é¸æ“‡...</option>
                    <option value="æ°‘äº‹ä¸€å¯©">æ°‘äº‹ä¸€å¯©</option>
                    <option value="æ°‘äº‹äºŒå¯©">æ°‘äº‹äºŒå¯©</option>
                    <option value="æ°‘äº‹ä¸‰å¯©">æ°‘äº‹ä¸‰å¯©</option>
                    <option value="åˆ‘äº‹ä¸€å¯©">åˆ‘äº‹ä¸€å¯©</option>
                    <option value="åˆ‘äº‹äºŒå¯©">åˆ‘äº‹äºŒå¯©</option>
                    <option value="åˆ‘äº‹ä¸‰å¯©">åˆ‘äº‹ä¸‰å¯©</option>
                    <option value="è¡Œæ”¿è¨´é¡˜">è¡Œæ”¿è¨´é¡˜</option>
                    <option value="è¡Œæ”¿ä¸€å¯©">è¡Œæ”¿ä¸€å¯©</option>
                    <option value="è¡Œæ”¿äºŒå¯©">è¡Œæ”¿äºŒå¯©</option>
                    <option value="å¼·åˆ¶åŸ·è¡Œ">å¼·åˆ¶åŸ·è¡Œ</option>
                    <option value="å…¶ä»–">å…¶ä»–</option>
                </select>
            </div>

            <div class="form-label">å‚™è¨»</div>
            <div class="form-colon">ï¼š</div>
            <div><input type="text" id="note-top"></div>

            
        </div>

        <div class="checklist-container">
            <div class="instruction">
                â˜… ä»¥ä¸‹æ‡‰å‚™æ–‡ä»¶ï¼Œå‡è«‹æä¾›æ–‡ä»¶å½±åƒä¹‹é›»å­æª”ï¼Œä¸¦ä»¥é›»å­éƒµä»¶å‚³é€è‡³ï¼š
                <span class="email-link">service@jeffreylaw.com.tw</span>
            </div>

            <label class="check-item"><input type="checkbox" value="è­¦å±€é€šçŸ¥"><span>è­¦å±€é€šçŸ¥</span></label>
            <label class="check-item"><input type="checkbox" value="æª¢å¯Ÿç½²é€šçŸ¥æˆ–è™•åˆ†æ›¸"><span>æª¢å¯Ÿç½²é€šçŸ¥æˆ–è™•åˆ†æ›¸</span></label>
            <label class="check-item"><input type="checkbox" value="æ³•é™¢é€šçŸ¥æˆ–è£åˆ¤"><span>æ³•é™¢é€šçŸ¥æˆ–è£åˆ¤</span></label>
            <label class="check-item"><input type="checkbox" value="å…¶ä»–å·²ç¶“æ”¶åˆ°çš„å…¬å‹™æ©Ÿé—œå…¬æ–‡"><span>å…¶ä»–å·²ç¶“æ”¶åˆ°çš„å…¬å‹™æ©Ÿé—œå…¬æ–‡</span></label>
            <label class="check-item"><input type="checkbox" value="å§”è¨—äººèº«åˆ†è­‰æ­£é¢"><span>å§”è¨—äººèº«åˆ†è­‰æ­£é¢</span></label>
            <label class="check-item"><input type="checkbox" value="å…¨æˆ¶æˆ¶ç±è¬„æœ¬"><span>å…¨æˆ¶æˆ¶ç±è¬„æœ¬</span></label>
            <label class="check-item"><input type="checkbox" value="å€‹äººæˆ¶ç±è¬„æœ¬(è¨˜äº‹æ¬„è«‹å‹¿çœç•¥)"><span>å€‹äººæˆ¶ç±è¬„æœ¬ (è¨˜äº‹æ¬„è«‹å‹¿çœç•¥)</span></label>
            <label class="check-item"><input type="checkbox" value="é™¤æˆ¶æˆ¶ç±è¬„æœ¬"><span>é™¤æˆ¶æˆ¶ç±è¬„æœ¬</span></label>
            <label class="check-item"><input type="checkbox" value="ç¹¼æ‰¿ç³»çµ±è¡¨"><span>ç¹¼æ‰¿ç³»çµ±è¡¨</span></label>
            <label class="check-item"><input type="checkbox" value="èˆ‡ç›¸å°äººå¾€ä¾†çš„æ›¸é¢ç´€éŒ„"><span>èˆ‡ç›¸å°äººå¾€ä¾†çš„æ›¸é¢ç´€éŒ„</span></label>
            <label class="check-item"><input type="checkbox" value="èˆ‡æœ¬ä»¶æœ‰é—œçš„æ‰€æœ‰å¥‘ç´„æ›¸é¢"><span>èˆ‡æœ¬ä»¶æœ‰é—œçš„æ‰€æœ‰å¥‘ç´„æ›¸é¢</span></label>
            <label class="check-item"><input type="checkbox" value="èˆ‡æœ¬ä»¶æœ‰é—œçš„ç¶²é æˆ–å°è©±ç´€éŒ„æˆªåœ–"><span>èˆ‡æœ¬ä»¶æœ‰é—œçš„ç¶²é æˆ–å°è©±ç´€éŒ„æˆªåœ–</span></label>
            <label class="check-item"><input type="checkbox" value="èˆ‡æœ¬ä»¶æœ‰é—œçš„ç…§ç‰‡"><span>èˆ‡æœ¬ä»¶æœ‰é—œçš„ç…§ç‰‡</span></label>
            
            <div class="check-item">
                <input type="checkbox" id="chk-other" value="å…¶ä»–">
                <span style="flex-grow: 1; display: flex; align-items: center;">
                    <span style="white-space: nowrap;">å…¶ä»–</span>
                    <input type="text" id="other-text" class="inline-input" placeholder="è«‹è¼¸å…¥æ–‡ä»¶åç¨±">
                </span>
            </div>
            
            <div style="margin-top: 15px; padding-top: 10px; border-top: 1px dashed #ccc;">
                <span style="font-weight: bold; font-size: 0.9rem;">è£œå……äº‹é …ï¼š</span>
                <input type="text" id="note-bottom" style="width: 100%; border-bottom: 1px solid #ccc;">
            </div>
        </div>
    </div>

    <div class="btn-group">
        <button class="btn btn-img" onclick="generateImage(this)">
            ğŸ“· ç”Ÿæˆåœ–ç‰‡
        </button>
        <button class="btn btn-share" onclick="shareText(this)">
            ğŸ“¤ åˆ†äº«æ¸…å–®
        </button>
    </div>

    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => navigator.serviceWorker.register('./sw.js'));
      }

      // ç”Ÿæˆåœ–ç‰‡åŠŸèƒ½
      function generateImage(btn) {
        const originalText = btn.innerText;
        btn.innerText = "è™•ç†ä¸­...";
        document.querySelector('.btn-group').style.display = 'none';

        html2canvas(document.getElementById('capture-area'), {
            scale: 2,
            backgroundColor: "#ffffff"
        }).then(canvas => {
            const link = document.createElement('a');
            const cause = document.getElementById('case-cause').value || 'æ¡ˆä»¶';
            link.download = `æ‡‰å‚™æ–‡ä»¶_${cause}.png`;
            link.href = canvas.toDataURL();
            link.click();
            btn.innerText = originalText;
            document.querySelector('.btn-group').style.display = 'flex';
        }).catch(err => {
            console.error(err);
            alert('åœ–ç‰‡ç”Ÿæˆå¤±æ•—');
            btn.innerText = originalText;
            document.querySelector('.btn-group').style.display = 'flex';
        });
      }

      // Web Share API åˆ†äº«æ–‡å­—åŠŸèƒ½ (å«å…¶ä»–è¼¸å…¥æ¡†é‚è¼¯)
      function shareText(btn) {
        // 1. æ”¶é›†è³‡æ–™
        const level = document.getElementById('case-level').value || "æœªæŒ‡å®šå¯©ç´š";
        const noteTop = document.getElementById('note-top').value;
        const cause = document.getElementById('case-cause').value || "æœªå¡«å¯«";
        const noteBottom = document.getElementById('note-bottom').value;

        // 2. æ”¶é›†å‹¾é¸é …ç›®
        let checkedItems = [];
        // å…ˆæŠ“ä¸€èˆ¬é …ç›®
        document.querySelectorAll('.checklist-container label input[type="checkbox"]:checked').forEach(chk => {
            checkedItems.push("â˜‘ " + chk.value);
        });
        
        // ç‰¹åˆ¥è™•ç†ã€Œå…¶ä»–ã€é¸é …
        const chkOther = document.getElementById('chk-other');
        if (chkOther.checked) {
            const otherText = document.getElementById('other-text').value.trim();
            if (otherText) {
                checkedItems.push("â˜‘ å…¶ä»–ï¼š" + otherText);
            } else {
                checkedItems.push("â˜‘ å…¶ä»–");
            }
        }

        if (checkedItems.length === 0) {
            return alert("è«‹è‡³å°‘å‹¾é¸ä¸€é …æ‡‰å‚™æ–‡ä»¶ï¼");
        }

        // 3. çµ„åˆæ–‡å­—å…§å®¹
        let shareContent = `ã€æ¡ˆä»¶æ‡‰å‚™æ–‡ä»¶æ¸…å–®ã€‘\n\n`;
        shareContent += `æ¡ˆç”±ï¼š${cause}\n`;
        shareContent += `å¯©ç´šï¼š${level}\n`;
        if (noteTop) shareContent += `å‚™è¨»ï¼š${noteTop}\n`;
        shareContent += `\nè«‹æº–å‚™ä»¥ä¸‹æ–‡ä»¶é›»å­æª”ï¼Œä¸¦ä»¥ Email å¯„è‡³ï¼š\nservice@jeffreylaw.com.tw\n\n`;
        shareContent += checkedItems.join('\n');
        
        if (noteBottom) shareContent += `\n\nè£œå……äº‹é …ï¼š${noteBottom}`;

        // 4. å‘¼å« Web Share API
        if (navigator.share) {
            navigator.share({
                title: 'æ‡‰å‚™æ–‡ä»¶æ¸…å–®',
                text: shareContent
            })
            .then(() => console.log('åˆ†äº«æˆåŠŸ'))
            .catch((error) => console.log('åˆ†äº«å–æ¶ˆæˆ–å¤±æ•—', error));
        } else {
            navigator.clipboard.writeText(shareContent).then(() => {
                alert("å·²å°‡æ¸…å–®è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼");
            });
        }
      }
    </script>
</body>
</html>
